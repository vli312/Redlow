{% extends 'page/base.html' %}
{% load static %}
{% load humanize %}
{% block page-title %}Review{% endblock %}
{% block reviewSelected %}selected{% endblock %}

{% block content %}
<div id="comments">
    <h2 class='section-title'>Review</h2>


    {% if request.session.username %}
    <form id="register-users" method="POST">
        {% csrf_token %}
        <textarea name="text" rows="3" placeholder="Write your review here..." required></textarea><br>

        <label>Region:
            <select name="region_id" required>
              <option value="" disabled selected>Select a region</option>
              {% for region in regions %}
                <option value="{{ region.region_id }}">{{ region.region_name }} ({{ region.region_type }})</option>
              {% endfor %}
            </select>
        </label><br>

        <label>Rating:
            <select name="rating">
                {% for i in "12345" %}
                <option value="{{ i }}">{{ i }}</option>
                {% endfor %}
            </select>
        </label><br>

        <label>Bedrooms: <input type="number" name="num_bedrooms" min="0" required></label><br>
        <label>Bathrooms: <input type="number" name="num_bathrooms" min="0" required></label><br>
        <label>Price Paid ($): <input type="number" name="price_paid" min="0" step="0.01" required></label><br>
        <label>Ownership:
            <select name="ownership_status">
                <option value="rent">Rent</option>
                <option value="own">Own</option>
            </select>
        </label><br>
        <label>ZIP Code: <input type="text" name="zip_code" maxlength="10"></label><br>

        <button type="submit" name="submit" value="Add">Add Review</button>
    </form>
    {% endif %}

    <div id='comment-box'>
        <ul id='comments-list'>
            {% for review in reviews %}
            <li>
                <img src='{% static 'img/personIcon.png' %}' alt='PersonIcon'>
                <p><strong><a href="{% url 'users:profile' review.user.username %}">{{ review.user.username }}</a></strong> - {{ review.created_at | naturalday }}</p>
                <p><strong>Region:</strong> {{ review.region.region_name }} ({{ review.region.region_type }})</p>
                <p><strong>Rating:</strong> {{ review.rating }}/5</p>
                <p><strong>Review:</strong> {{ review.content }}</p>
                <p><strong>Bedrooms:</strong> {{ review.num_bedrooms }} | <strong>Bathrooms:</strong> {{ review.num_bathrooms }}</p>
                <p><strong>Price Paid:</strong> ${{ review.price_paid }}</p>
                <p><strong>Status:</strong> {{ review.get_ownership_status_display }}</p>
                <p><strong>ZIP Code:</strong> {{ review.zip_code }}</p>

                {% if review.user.username == request.session.username or request.session.role == 'admin' %}
                <form method="POST">
                    {% csrf_token %}
                    <input type="hidden" name="review_id" value="{{ review.id }}">
                    <input type="submit" name="submit" value="Delete" id="edit-comment">
                </form>
                {% endif %}
            </li>
            {% empty %}
            <li>No reviews yet</li>
            {% endfor %}
        </ul>
    </div>
</div>
{% endblock %}
